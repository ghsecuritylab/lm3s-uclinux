SQLITE_SRC = sqlite-autoconf-3071401

CONFIGURE_OPTIONS += --without-gnu-ld
CONFIGURE_OPTIONS += --without-pic
CONFIGURE_OPTIONS += --disable-threadsafe
CONFIGURE_OPTIONS += --disable-dynamic-extensions
CONFIGURE_OPTIONS += --disable-readline
CONFIGURE_OPTIONS += --disable-shared
CONFIGURE_OPTIONS += --enable-static
CONFIGURE_OPTIONS += --disable-largefile

# CFLAGS += -DSQLITE_OMIT_COMPILEOPTION_DIAGS=1
# CFLAGS += -DSQLITE_OMIT_DEPRECATED=1
# CFLAGS += -DSQLITE_OMIT_TEMPDB=1
# #CFLAGS += -DSQLITE_OMIT_ANALYZE=1
# #CFLAGS += -DSQLITE_OMIT_ATTACH=1
# CFLAGS += -DSQLITE_OMIT_AUTHORIZATION=1
# CFLAGS += -DSQLITE_OMIT_AUTOMATIC_INDEX=1
# #CFLAGS += -DSQLITE_OMIT_AUTOVACUUM=1
# CFLAGS += -DSQLITE_OMIT_BLOB_LITERAL=1
# CFLAGS += -DSQLITE_OMIT_BTREECOUNT=1
# CFLAGS += -DSQLITE_OMIT_BUILTIN_TEST=1
# CFLAGS += -DSQLITE_OMIT_CAST=1
# CFLAGS += -DSQLITE_OMIT_CHECK=1
# #SQLITE_OMIT_COMPLETE
# CFLAGS += -DSQLITE_OMIT_COMPOUND_SELECT
# CFLAGS += -DSQLITE_OMIT_DATETIME_FUNCS
# CFLAGS += -DSQLITE_OMIT_DECLTYPE
# CFLAGS += -DSQLITE_OMIT_EXPLAIN
# CFLAGS += -DSQLITE_OMIT_FOREIGN_KEY
# CFLAGS += -DSQLITE_OMIT_INTEGRITY_CHECK
# CFLAGS += -DSQLITE_OMIT_LIKE_OPTIMIZATION
#
# CFLAGS += -DSQLITE_OMIT_LOAD_EXTENSION
# CFLAGS += -DSQLITE_OMIT_LOCALTIME
# #SQLITE_OMIT_LOOKASIDE
# CFLAGS += -DSQLITE_OMIT_MEMORYDB
# CFLAGS += -DSQLITE_OMIT_MERGE_SORT
# CFLAGS += -DSQLITE_OMIT_OR_OPTIMIZATION
# CFLAGS += -DSQLITE_OMIT_PAGER_PRAGMAS
# CFLAGS += -DSQLITE_OMIT_PROGRESS_CALLBACK
# CFLAGS += -DSQLITE_OMIT_QUICKBALANCE
# #CFLAGS += -DSQLITE_OMIT_REINDEX
# CFLAGS += -DSQLITE_OMIT_SCHEMA_PRAGMAS
#
# CFLAGS += -DSQLITE_OMIT_SCHEMA_VERSION_PRAGMAS
# CFLAGS += -DSQLITE_OMIT_SHARED_CACHE
# CFLAGS += -DSQLITE_OMIT_SUBQUERY
# CFLAGS += -DSQLITE_OMIT_TCL_VARIABLE
# CFLAGS += -DSQLITE_OMIT_TRACE
# #CFLAGS += -DSQLITE_OMIT_TRIGGER
#
# CFLAGS += -DSQLITE_OMIT_UTF16
# #CFLAGS += -DSQLITE_OMIT_VIEW
# #CFLAGS += -DSQLITE_OMIT_VIRTUALTABLE
# CFLAGS += -DSQLITE_OMIT_XFER_OPT
#
# CFLAGS += -DSQLITE_OMIT_WAL
# #CFLAGS += -DSQLITE_OMIT_WSD

PREFIX = $(CURDIR)/output

all: build
	$(MAKE) -C build
	$(MAKE) -C build install

.phony: build
build: Makefile
	mkdir -p build
	(cd build; CC="$(CC) $(CFLAGS)" LDFLAGS="$(LDFLAGS)" LIBS="$(LDLIBS)" ../$(SQLITE_SRC)/configure --host=$(CROSS_COMPILE:-=) --prefix=$(PREFIX) $(CONFIGURE_OPTIONS))

romfs:
ifdef CONFIG_LIB_SQLITE_SHELL
	$(ROMFSINST) output/bin/sqlite3 /bin/sqlite3
endif

clean:
	rm -rf build
	rm -rf output