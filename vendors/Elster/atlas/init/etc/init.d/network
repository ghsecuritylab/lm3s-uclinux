#!/bin/sh

if [ -z "$network" ]; then
	cfg network > /tmp/network_conf
	. /tmp/network_conf
	rm /tmp/network_conf
fi

touch /etc/resolv.conf
touch /etc/hosts

if [ "$network_lo_enable" == "yes" ]; then
	ifconfig lo $network_lo_ipaddr netmask $network_lo_netmask
	echo "$network_lo_ipaddr localhost" >> /etc/hosts
fi

if [ "$network_eth0_enable" == "yes" ]; then
	if [ "$network_eth0_proto" = "static" ]; then
		ifconfig eth0 down
		ifconfig eth0 hw ether $network_eth0_macaddr
		ifconfig eth0 up
		ifconfig eth0 $network_eth0_ipaddr netmask $network_eth0_netmask
		if [ -n "$network_eth0_gateway" -a "$network_eth0_gateway" != "0.0.0.0" ]; then
			route add default gw $network_eth0_gateway metric 100 dev eth0
		fi
	fi
fi

if [ -n "$network_dns_nameserver" -a "$network_dns_nameserver" != "0.0.0.0" ]; then
	echo "nameserver $network_dns_nameserver" >> /etc/resolv.conf
fi

if [ "$network_ppp0_enable" == "yes" ]; then
	start-stop-daemon -p /var/run/pppd0.pid -x pppd -b -S -- call gprs
fi