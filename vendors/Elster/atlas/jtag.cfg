source [find interface/olimex-jtag-tiny.cfg]
set WORKAREASIZE 0x4000
set CHIPNAME tm4cxxxx
source [find target/stellaris.cfg]

proc flash_mcu { image_file disk_image } {
  init
  reset_config srst_only
  reset
  reset_config none
  reset init

  reset halt
  wait_halt
  sleep 10

  poll
  flash probe 0

  flash write_image erase $image_file
  verify_image $image_file

  flash write_image erase $disk_image 0x50000
  verify_image $disk_image 0x50000

  reset_config srst_only
  reset

  shutdown
}

proc do_reset_mcu {} {
  halt
  wait_halt
  sleep 10
  reset
  sleep 10
}

proc reset_mcu {} {
  do_reset_mcu
  shutdown
}

proc load_sdram { image_file } {
  halt
  wait_halt
  sleep 10

  load_image $image_file 0x60400000

  resume
  shutdown
}

proc start_kernel { image_file } {
  do_reset_mcu
  sleep 1000
  load_sdram $image_file
}